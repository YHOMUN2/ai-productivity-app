import{v as N,_ as M,r as y,x as U,y as $,a as h,o as m,e as r,n as x,t as C,k as w,z,w as I,l as L,i as V,b as v,F as D,m as j,s as W,j as k,A as S,g as E,B}from"./index-B2QBWZZT.js";import{a as R}from"./index-B9ygI19o.js";function F(e){const t=Array.isArray(e)?e.slice():[];return R.post("http://localhost:3001/api/chat",{model:"doubao-seed-1-6-251015",messages:t})}function H(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8)}const K=N("chat",{state:()=>({chats:[],currentId:null}),getters:{current:e=>e.chats.find(t=>t.id===e.currentId)||null},actions:{createChat(){const e=H(),t={id:e,title:"æ–°å¯¹è¯",messages:[],createdAt:Date.now()};return this.chats.unshift(t),this.currentId=e,e},selectChat(e){this.chats.find(t=>t.id===e)&&(this.currentId=e)},addUser(e){this.currentId||this.createChat();const t=this.chats.find(i=>i.id===this.currentId);if(t&&(t.messages.push({role:"user",text:e}),(!t.title||t.title==="æ–°å¯¹è¯")&&e)){const i=e.length>20?e.slice(0,20)+"...":e;t.title=i}},addAI(e){this.currentId||this.createChat();const t=this.chats.find(i=>i.id===this.currentId);t&&t.messages.push({role:"ai",text:e})},clearCurrent(){const e=this.chats.find(t=>t.id===this.currentId);e&&(e.messages=[])},removeChat(e){this.chats=this.chats.filter(t=>t.id!==e),this.currentId===e&&(this.currentId=this.chats.length?this.chats[0].id:null)}},persist:!0}),J={class:"avatar"},O={class:"bubble-wrapper"},q={key:0,class:"typewriter-text"},G={key:1},P={class:"message-meta"},Q={__name:"ChatMessage",props:{isUser:{type:Boolean,default:!1},content:{type:String,default:""},isTyping:{type:Boolean,default:!1},timestamp:{type:[Number,String],default:null}},setup(e){const t=e,i=y(""),d=y(0),p=U(()=>{if(!t.timestamp)return"";const o=new Date(t.timestamp),f=String(o.getHours()).padStart(2,"0"),b=String(o.getMinutes()).padStart(2,"0");return`${f}:${b}`});$(()=>t.content,o=>{if(!o){i.value="",d.value=0;return}t.isTyping&&!t.isUser?(i.value="",d.value=0,u(o)):(i.value=o,d.value=0)},{immediate:!0}),$(()=>t.isTyping,o=>{!o&&i.value!==t.content&&(i.value=t.content,d.value=t.content.length)});function u(o){d.value<o.length&&(i.value=o.slice(0,d.value+1),d.value++,setTimeout(()=>u(o),30))}return(o,f)=>(m(),h("div",{class:x(["message",e.isUser?"user":"ai"])},[r("div",J,[r("div",{class:x(["avatar-icon",e.isUser?"user-icon":"ai-icon"])},C(e.isUser?"ğŸ‘¤":"ğŸ¤–"),3)]),r("div",O,[(m(),h("div",{class:x(["bubble",{typing:e.isTyping}]),key:i.value},[e.isTyping&&!e.isUser?(m(),h("span",q,[w(C(i.value),1),f[0]||(f[0]=r("span",{class:"cursor"},null,-1))])):(m(),h("span",G,C(i.value),1))],2)),r("div",P,C(p.value),1)])],2))}},X=M(Q,[["__scopeId","data-v-66d1de35"]]),Y={class:"card-header"},Z={key:0,class:"message-wrapper loading-indicator"},tt={class:"input-area"},et={class:"input-actions"},st={__name:"ChatWindow",props:{messages:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!1}},emits:["send","save-conversation"],setup(e,{expose:t,emit:i}){const d=e,p=i,u=y(""),o=y(null);$(()=>d.messages.length,async()=>{await S(),f()}),$(()=>d.isLoading,async g=>{g&&(await S(),f())});function f(){o.value&&(o.value.scrollTop=o.value.scrollHeight)}return t({send:()=>{const g=u.value.trim();g&&!d.isLoading&&(p("send",g),u.value="")},scrollToBottom:f}),(g,l)=>{const A=k("el-button"),T=k("el-input"),s=k("el-card");return m(),z(s,{class:"chat-window-card"},{header:I(()=>[r("div",Y,[l[5]||(l[5]=r("span",{class:"title"},"AI å¯¹è¯",-1)),v(A,{type:"primary",text:"",size:"small",onClick:l[0]||(l[0]=n=>g.$emit("save-conversation"))},{default:I(()=>[...l[4]||(l[4]=[w(" ğŸ’¾ ä¿å­˜å¯¹è¯ ",-1)])]),_:1})])]),default:I(()=>[r("div",{class:"messages-container",ref_key:"messagesBox",ref:o},[(m(!0),h(D,null,V(e.messages,(n,a)=>(m(),h("div",{key:a,class:"message-wrapper"},[v(X,{"is-user":n.role==="user",content:n.text,"is-typing":n.isTyping},null,8,["is-user","content","is-typing"])]))),128)),e.isLoading?(m(),h("div",Z,[...l[6]||(l[6]=[r("div",{class:"loading-bubble"},[r("span",{class:"dot"}),r("span",{class:"dot"}),r("span",{class:"dot"})],-1)])])):L("",!0)],512),r("div",tt,[v(T,{modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=n=>u.value=n),type:"textarea",rows:3,placeholder:"è¾“å…¥ä½ çš„é—®é¢˜æˆ–æŒ‡ä»¤...",disabled:e.isLoading,onKeyup:l[2]||(l[2]=j(W(n=>g.$emit("send",u.value),["ctrl"]),["enter"]))},null,8,["modelValue","disabled"]),r("div",et,[l[8]||(l[8]=r("span",{class:"hint"},"Ctrl+Enter å‘é€",-1)),v(A,{type:"primary",onClick:l[3]||(l[3]=n=>g.$emit("send",u.value)),loading:e.isLoading,disabled:!u.value.trim()||e.isLoading},{default:I(()=>[...l[7]||(l[7]=[w(" å‘é€ ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1})}}},nt=M(st,[["__scopeId","data-v-238fa26c"]]),at={class:"ai-assistant-page"},it={class:"conversation-sidebar"},rt={class:"sidebar-header"},ot={class:"conversation-list"},lt=["onClick"],ct={class:"conv-title"},dt={class:"conv-meta"},ut={key:0,class:"empty-state"},mt={class:"chat-main"},ht={__name:"AIAssistant",setup(e){const t=K(),i=y(!1),d=y(null),p=y(-1);function u(s){try{if(!s)return"[æ— å›åº”]";if(s.data&&typeof s.data.answer=="string")return s.data.answer;const n=s.data&&s.data.choices;if(Array.isArray(n)&&n.length){const a=n[0].message||n[0],c=a.content;if(Array.isArray(c))return c.map(_=>_.text||_).join("");if(typeof c=="string")return a.reasoning_content&&typeof a.reasoning_content=="string"?c+`

`+a.reasoning_content:c;if(c&&typeof c.text=="string")return c.text;if(a.reasoning_content&&typeof a.reasoning_content=="string")return a.reasoning_content}return s.data&&s.data.data&&typeof s.data.data.answer=="string"?s.data.data.answer:"[æ— å›åº”]"}catch{return"[è§£æè¿”å›å‡ºé”™]"}}async function o(s){const n=s.trim();if(!(!n||i.value)){t.addUser(n),await S(),i.value=!0;try{t.addAI("");const a=t.current.messages.length-1;p.value=a;const c=await F([{role:"user",content:n}]),_=u(c);t.current&&a<t.current.messages.length&&(t.current.messages[a].text=_)}catch(a){const c=t.current?.messages.length-1;c>=0&&(t.current.messages[c].text="âŒ AI æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•"),console.error("chatWithAI error:",a)}finally{i.value=!1,p.value=-1,d.value&&(await S(),d.value.scrollToBottom())}}}function f(){const s=t.current;if(!s)return;const n=JSON.stringify(s,null,2),a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download",`conversation-${s.id}.json`),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}E(()=>{t.currentId||t.createChat()});const b=U(()=>!t.current||!Array.isArray(t.current.messages)?[]:t.current.messages.map((s,n)=>({...s,isTyping:!i.value&&n===p.value&&s.role==="ai",timestamp:s.timestamp||Date.now()})));function g(){t.createChat(),p.value=-1}function l(s){t.selectChat(s),p.value=-1}function A(s){t.removeChat(s)}function T(s){return s?new Date(s).toLocaleString():""}return(s,n)=>{const a=k("el-button");return m(),h("div",at,[r("aside",it,[r("div",rt,[v(a,{type:"primary",size:"large",class:"new-chat-btn",onClick:g},{default:I(()=>[...n[0]||(n[0]=[w(" â• æ–°å¯¹è¯ ",-1)])]),_:1})]),r("div",ot,[(m(!0),h(D,null,V(B(t).chats,c=>(m(),h("div",{key:c.id,class:x(["conversation-item",{active:c.id===B(t).currentId}]),onClick:_=>l(c.id)},[r("div",ct,C(c.title),1),r("div",dt,C(T(c.createdAt)),1),v(a,{type:"danger",text:"",size:"small",class:"delete-btn",onClick:W(_=>A(c.id),["stop"]),icon:"Delete"},null,8,["onClick"])],10,lt))),128)),B(t).chats.length?L("",!0):(m(),h("div",ut,[...n[1]||(n[1]=[w("æš‚æ— å¯¹è¯",-1),r("br",null,null,-1),w('ç‚¹å‡»"æ–°å¯¹è¯"å¼€å§‹',-1)])]))])]),r("main",mt,[v(nt,{ref_key:"chatWindowRef",ref:d,messages:b.value,"is-loading":i.value,onSend:o,onSaveConversation:f},null,8,["messages","is-loading"])])])}}},pt=M(ht,[["__scopeId","data-v-42f06e89"]]);export{pt as default};
