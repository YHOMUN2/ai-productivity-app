# Avatar åŒæ­¥æ¶æ„éªŒè¯æŠ¥å‘Š

## é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åé¦ˆçš„æ ¸å¿ƒé—®é¢˜ï¼š**"å¤´åƒæ›´æ–°äº†ï¼Œä½†å„ä¸ªé¡µé¢æ‹¿çš„æ˜¯'ä¸åŒæ¥æºçš„æ•°æ®'"**

è¿™ä¸æ˜¯ä¸Šä¼ å¤±è´¥ï¼Œè€Œæ˜¯æ¶æ„è®¾è®¡é—®é¢˜ - å¤šä¸ªé¡µé¢ä»ä¸åŒçš„æ•°æ®æºè¯»å–å¤´åƒï¼Œå¯¼è‡´æ›´æ–°ä¸åŒæ­¥ã€‚

## è§£å†³æ–¹æ¡ˆï¼šå•ä¸€æ•°æ®æºæ¶æ„

### æ¶æ„åŸç†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Pinia User Store                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  state.profile.avatar_url     â”‚ â—„â”€â”€â”€ å”¯ä¸€æƒå¨æ¥æº
â”‚  â”‚  (ç”¨æˆ·ä¸Šä¼ çš„å¤´åƒ URL)          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â–²                               â”‚
â”‚           â”‚                               â”‚
â”‚   updateAvatarInStore() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   (ç«‹å³æ›´æ–°çŠ¶æ€ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“)         â”‚ â”‚
â”‚           â–²                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚            â”‚          â”‚          â”‚
   Profile    ChangeAvatar  UserMenu   AppLayout
   (è¯»å–)       (è¯»å–æ›´æ–°)   (è¯»å–)     (è¯»å–)
   :src="        :src="      :src="     :src="
   userStore.    userStore.  userStore. userStore.
   userAvatar    userAvatar  userAvatar userAvatar
```

### æ ¸å¿ƒå®ç°ç»†èŠ‚

#### 1. State ä¸­çš„æ•°æ®æºï¼ˆsrc/stores/user.jsï¼‰

```javascript
state: () => ({
  user: null,
  profile: null,  // â—„â”€â”€â”€ åŒ…å« avatar_urlï¼ˆå”¯ä¸€å¤´åƒæ•°æ®æ¥æºï¼‰
  isLoggedIn: false,
  loading: false,
  error: null
})
```

#### 2. å”¯ä¸€çš„å¤´åƒè¯»å– Getterï¼ˆsrc/stores/user.jsï¼‰

```javascript
userAvatar: (state) => {
  // ä¼˜å…ˆä» profile.avatar_url è¯»å–ï¼ˆæƒå¨æ¥æºï¼‰
  if (state.profile?.avatar_url) {
    return state.profile.avatar_url;
  }
  // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ DiceBear API ç”Ÿæˆé»˜è®¤å¤´åƒ
  const email = state.user?.email || '';
  return `https://api.dicebear.com/7.x/avataaars/svg?seed=${email}`;
}
```

#### 3. ç«‹å³æ›´æ–°æ–¹æ³•ï¼ˆsrc/stores/user.jsï¼‰

```javascript
updateAvatarInStore(avatarUrl) {
  // ç«‹å³æ›´æ–°çŠ¶æ€ï¼Œæ‰€æœ‰ç»‘å®šæ­¤ getter çš„ç»„ä»¶ç¬é—´æ›´æ–°
  if (this.profile) {
    this.profile.avatar_url = avatarUrl;
  }
},

async updateAvatar(avatarUrl) {
  this.updateAvatarInStore(avatarUrl);  // â—„â”€â”€â”€ ç«‹å³è§¦å‘ UI æ›´æ–°
  // ç„¶åå¼‚æ­¥æŒä¹…åŒ–åˆ°æ•°æ®åº“
}
```

#### 4. æ‰€æœ‰é¡µé¢çš„ç»‘å®šæ–¹å¼ï¼ˆæ­£ç¡®åšæ³•ï¼‰

**Profile.vue:**
```vue
<img :src="userStore.userAvatar" class="profile-avatar" />
```

**ChangeAvatar.vue:**
```vue
<img :src="userStore.userAvatar" />
```

**UserMenu.vue:**
```vue
<img :src="userStore.userAvatar" />
```

**AppLayout.vue:**
```vue
<img :src="userStore.userAvatar" />
```

## æ¶æ„çš„æ­£ç¡®æ€§éªŒè¯

### âœ… ä¸ºä»€ä¹ˆè¿™ä¸ªè®¾è®¡æ˜¯å¯¹çš„ï¼Ÿ

| åŸåˆ™ | è¯´æ˜ | å®ç° |
|------|------|------|
| **å•ä¸€æ¥æº** | æ•°æ®åªåœ¨ä¸€ä¸ªåœ°æ–¹å­˜å‚¨å’Œä¿®æ”¹ | `profile.avatar_url` |
| **å“åº”å¼åŒæ­¥** | å½“æ•°æ®æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨å®ƒçš„åœ°æ–¹è‡ªåŠ¨æ›´æ–° | Vue 3 Reactive + Pinia |
| **æ— ç«æ€æ¡ä»¶** | ä¸ä¼šå‡ºç°"æœ‰çš„é¡µé¢å·²æ›´æ–°ï¼Œæœ‰çš„é¡µé¢æœªæ›´æ–°"çš„çŠ¶æ€ | userAvatar getter ä¿è¯ä¸€è‡´æ€§ |
| **æ€§èƒ½ä¼˜åŒ–** | é¿å…é‡å¤è®¡ç®—å’Œä¸å¿…è¦çš„çŠ¶æ€ç®¡ç† | åªéœ€ä¸€ä¸ª getterï¼Œä¸éœ€è¦ watch æˆ– computed |
| **æ˜“äºç»´æŠ¤** | å¦‚æœè¦æ”¹å˜è·å–å¤´åƒçš„é€»è¾‘ï¼Œåªéœ€æ”¹ä¸€ä¸ªåœ°æ–¹ | ä¿®æ”¹ userAvatar getter |

### âœ… ä¸é”™è¯¯è®¾è®¡çš„å¯¹æ¯”

#### âŒ é”™è¯¯åšæ³•ï¼ˆå¯¼è‡´ä¸åŒæ­¥ï¼‰

```javascript
// Profile.vue
const currentAvatar = computed(() => userStore.userAvatar);

// ChangeAvatar.vue  
const previewAvatar = ref(defaultAvatar);  // â—„â”€â”€â”€ æœ¬åœ°çŠ¶æ€ï¼

// UserMenu.vue
const avatarUrl = computed(() => userStore.userAvatar);

// ç»“æœï¼šChangeAvatar æ›´æ–°è‡ªå·±çš„æœ¬åœ°çŠ¶æ€ï¼Œä½†å…¶ä»–é¡µé¢è¯»çš„æ˜¯ userStore
// å¯¼è‡´ï¼šæ›´æ–°åå„é¡µé¢æ˜¾ç¤ºä¸åŒ
```

#### âœ… æ­£ç¡®åšæ³•ï¼ˆæœ¬é¡¹ç›®é‡‡ç”¨ï¼‰

```javascript
// æ‰€æœ‰é¡µé¢éƒ½è¿™æ ·åšï¼š
<img :src="userStore.userAvatar" />

// å½“æ›´æ–°æ—¶ï¼š
userStore.updateAvatarInStore(newUrl);  // ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹
// æ‰€æœ‰ç»‘å®šè‡ªåŠ¨åŒæ­¥ï¼Œå› ä¸ºå®ƒä»¬éƒ½è¯»åŒä¸€ä¸ª getter
```

## æµ‹è¯•éªŒè¯æµç¨‹

### æµ‹è¯•åœºæ™¯ï¼šç”¨æˆ·ä¸Šä¼ æ–°å¤´åƒ

**æ­¥éª¤ 1ï¼š** åœ¨ Profile é¡µé¢æŸ¥çœ‹å½“å‰å¤´åƒï¼ˆä¾‹å¦‚ï¼šDiceBear é»˜è®¤å¤´åƒï¼‰
- ä½ç½®ï¼š`/profile`
- æ˜¾ç¤ºï¼šé»˜è®¤ç”Ÿæˆçš„å¤´åƒ

**æ­¥éª¤ 2ï¼š** ç‚¹å‡»"ä¿®æ”¹å¤´åƒ"æŒ‰é’®ï¼Œè¿›å…¥ ChangeAvatar é¡µé¢
- ä½ç½®ï¼š`/change-avatar`
- ç°è±¡ï¼šæ˜¾ç¤ºåŒæ ·çš„å¤´åƒ

**æ­¥éª¤ 3ï¼š** ä¸Šä¼ æ–°å›¾ç‰‡ï¼ˆJPG/PNG/GIFï¼Œâ‰¤5MBï¼‰
- æ“ä½œï¼šæ‹–æ‹½æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
- é¢„è§ˆï¼šä¸Šä¼ å‰çœ‹åˆ°æ–°å›¾ç‰‡é¢„è§ˆ

**æ­¥éª¤ 4ï¼š** ç‚¹å‡»"ä¿å­˜å¤´åƒ"
- æ“ä½œï¼šè§¦å‘ `userStore.updateAvatarInStore(newUrl)`
- ç°è±¡ï¼šé¡µé¢è¿”å› /profile

**æ­¥éª¤ 5ï¼š** è§‚å¯Ÿæ‰€æœ‰ä½ç½®çš„å¤´åƒï¼ˆåº”è¯¥éƒ½æ˜¯æ–°çš„ï¼‰
- âœ… Profile é¡µé¢å¤´åƒï¼š**å·²æ›´æ–°ä¸ºæ–°å›¾ç‰‡**
- âœ… UserMenu å¤´åƒï¼š**å·²æ›´æ–°ä¸ºæ–°å›¾ç‰‡**
- âœ… AppLayout å¤´åƒï¼š**å·²æ›´æ–°ä¸ºæ–°å›¾ç‰‡**
- âœ… localStorage å·²ä¿å­˜ï¼ˆåˆ·æ–°ä¸ä¸¢å¤±ï¼‰

**æ­¥éª¤ 6ï¼š** éªŒè¯æ•°æ®ä¸€è‡´æ€§
- åˆ·æ–°é¡µé¢ï¼šæ‰€æœ‰ä½ç½®å¤´åƒä»ç„¶ç›¸åŒ
- åˆ‡æ¢è·¯ç”±ï¼šå¤´åƒä¿æŒä¸€è‡´
- æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ `localStorage` ä¸­çš„ profile.avatar_url

## æŒä¹…åŒ–è¯´æ˜

### Pinia è‡ªåŠ¨æŒä¹…åŒ–é…ç½®

```javascript
// src/stores/user.js
persist: true  // â—„â”€â”€â”€ è‡ªåŠ¨ä¿å­˜åˆ° localStorage
```

è¿™æ„å‘³ç€ï¼š
1. ç”¨æˆ·ä¸Šä¼ å¤´åƒ â†’ `profile.avatar_url` è¢«æ›´æ–°
2. Pinia è‡ªåŠ¨ä¿å­˜åˆ° `localStorage` ä¸­çš„ `user` store
3. ç”¨æˆ·å…³é—­æµè§ˆå™¨é‡æ–°æ‰“å¼€ â†’ ä» `localStorage` æ¢å¤
4. é¡µé¢åŠ è½½æ—¶ userStore åˆå§‹åŒ– â†’ æ‰€æœ‰é¡µé¢è‡ªåŠ¨è¯»åˆ°å·²ä¿å­˜çš„å¤´åƒ

## ç›‘æ§é¡µé¢

ä¸ºäº†å®æ—¶è§‚å¯Ÿæ¶æ„æ˜¯å¦å·¥ä½œæ­£å¸¸ï¼Œæ‰“å¼€æ¼”ç¤ºé¡µé¢ï¼š
```
http://localhost:5174/demo/avatar-sync
```

è¯¥é¡µé¢æä¾›ï¼š
- ğŸ“Š **æ•°æ®ç›‘æ§åŒº** - å®æ—¶æ˜¾ç¤º `userStore.userAvatar` çš„å€¼
- ğŸ¨ **ä¸‰ä½ç½®åŒæ­¥æ˜¾ç¤º** - å¹¶æ’æ˜¾ç¤º Profileã€UserMenuã€AppLayout ä½ç½®çš„å¤´åƒ
- ğŸ“‹ **å®Œæ•´æµ‹è¯•æµç¨‹** - ä¸€æ­¥æ­¥æŒ‡å¯¼éªŒè¯æ¶æ„
- ğŸ’» **ä»£ç ç¤ºä¾‹** - å±•ç¤ºå¦‚ä½•æ­£ç¡®é›†æˆ

## æ¶æ„ä¼˜åŠ¿æ€»ç»“

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **ğŸ¯ ç®€æ´** | æ‰€æœ‰é¡µé¢ä»£ç ä¸€è‡´ï¼Œæ˜“è¯»æ˜“ç»´æŠ¤ |
| **âš¡ å¿«é€Ÿ** | æ›´æ–°ç«‹å³ç”Ÿæ•ˆï¼Œæ— å»¶è¿Ÿ |
| **ğŸ”„ åŒæ­¥** | æ•°å­¦ä¸Šä¿è¯æ‰€æœ‰ä½ç½®æ€»æ˜¯ç›¸åŒ |
| **ğŸ›¡ï¸ å®‰å…¨** | å•ä¸€æ¥æºæ„å‘³ç€æ²¡æœ‰æ•°æ®å†²çªçš„å¯èƒ½ |
| **ğŸ“± å¯æ‰©å±•** | å³ä½¿æœ‰ 100 ä¸ªåœ°æ–¹æ˜¾ç¤ºå¤´åƒï¼Œä»ç„¶æ˜¯åŒä¸€ä¸ª getter |
| **ğŸ” æ˜“è°ƒè¯•** | è¦è¿½è¸ªå¤´åƒå˜åŒ–ï¼Œåªéœ€çœ‹ä¸€ä¸ªå˜é‡ |

## å…³é”®ä»£ç æ¸…å•

ä¸ºäº†éªŒè¯è¿™ä¸ªæ¶æ„å·²æ­£ç¡®å®ç°ï¼Œä»¥ä¸‹æ˜¯å…³é”®ä½ç½®ï¼š

1. **State å®šä¹‰**ï¼š`src/stores/user.js` ç¬¬ 14-20 è¡Œ
2. **å¤´åƒ Getter**ï¼š`src/stores/user.js` ç¬¬ 36-43 è¡Œ
3. **ç«‹å³æ›´æ–°æ–¹æ³•**ï¼š`src/stores/user.js` ç¬¬ 78-81 è¡Œ
4. **Profile ç»‘å®š**ï¼š`src/pages/Profile.vue` å¤´åƒ img æ ‡ç­¾
5. **ChangeAvatar æ›´æ–°**ï¼š`src/pages/ChangeAvatar.vue` ç¬¬ 268 è¡Œ `updateAvatarInStore`
6. **UserMenu ç»‘å®š**ï¼š`src/components/UserMenu.vue` å¤´åƒ img æ ‡ç­¾
7. **AppLayout ç»‘å®š**ï¼š`src/AppLayout.vue` å¤´åƒ img æ ‡ç­¾
8. **è·¯ç”±é…ç½®**ï¼š`src/router/index.js` AvatarSyncDemo è·¯ç”±

## æ€»ç»“

âœ… **é—®é¢˜å·²è§£å†³**ï¼šé€šè¿‡å•ä¸€æ•°æ®æºæ¶æ„ï¼Œå¤´åƒç°åœ¨ç¡®ä¿åœ¨æ‰€æœ‰é¡µé¢åŒæ­¥æ›´æ–°

âœ… **æ¶æ„éªŒè¯**ï¼šæ‰€æœ‰ç»„ä»¶éƒ½æ­£ç¡®åœ°ä» `userStore.userAvatar` getter è¯»å–ï¼Œä¸å†æœ‰å¤šä¸ªæ•°æ®æ¥æº

âœ… **å·¥ä½œæµç¨‹**ï¼šç”¨æˆ·ä¸Šä¼ å¤´åƒ â†’ `updateAvatarInStore()` ç«‹å³æ›´æ–°çŠ¶æ€ â†’ æ‰€æœ‰é¡µé¢è‡ªåŠ¨é‡æ–°æ¸²æŸ“

âœ… **å¯è§‚æµ‹æ€§**ï¼šAvatarSyncDemo é¡µé¢æä¾›å®æ—¶ç›‘æ§å’Œæµ‹è¯•å·¥å…·

