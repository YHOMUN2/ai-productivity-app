# 用户菜单功能测试指南

## 前置条件

- 项目已安装依赖：`npm install`
- 项目已启动：`npm run dev`
- 浏览器已打开：`http://localhost:5173/`

## 测试步骤

### 1. 初始状态检查（未登录）

**目标**：验证未登录状态下的导航栏显示

**步骤**：
1. 打开应用，不进行任何操作
2. 查看导航栏右侧

**预期结果**：
- ✅ 导航栏右侧显示一个蓝色按钮，文本为"登录"
- ✅ 没有用户头像或用户信息

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 2. 跳转到登录页

**目标**：验证登录按钮的功能

**步骤**：
1. 点击导航栏右侧的"登录"按钮
2. 观察页面变化

**预期结果**：
- ✅ 页面跳转到 `/login`
- ✅ 显示登录表单（邮箱、密码、登录按钮）

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 3. 表单验证

**目标**：验证登录表单的验证功能

**步骤**：
1. 在邮箱字段输入 `invalid-email`（不是有效邮箱格式）
2. 在密码字段输入 `123`（少于 6 个字符）
3. 点击"登录"按钮

**预期结果**：
- ✅ 邮箱字段显示红色边框和"请输入正确的邮箱地址"错误提示
- ✅ 密码字段显示红色边框和"密码长度不能少于 6 个字符"错误提示
- ✅ 登录请求未发送，页面保留在登录页

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 4. 成功登录

**目标**：验证登录功能和状态更新

**步骤**：
1. 在邮箱字段输入：`test@example.com`
2. 在密码字段输入：`password123`
3. 点击"登录"按钮
4. 等待响应

**预期结果**：
- ✅ 界面显示"登录成功！"提示信息（绿色）
- ✅ 500ms 后自动跳转到首页 `/`
- ✅ 导航栏右侧显示用户头像（圆形，带边框）
- ✅ 头像不显示"登录"按钮

**实际结果**：
- [ ] 通过 / [ ] 未通过

**注意**：当前实现使用模拟登录，任何符合格式的邮箱和密码都会成功。

### 5. 用户菜单打开

**目标**：验证用户头像点击功能

**步骤**：
1. 在首页（登录成功后）
2. 点击导航栏右侧的用户头像
3. 观察菜单展开

**预期结果**：
- ✅ 用户头像周围出现悬停效果（亮度增加或缩放）
- ✅ 点击后菜单下拉展开
- ✅ 菜单显示用户信息卡片
  - 用户头像（较大，约 48px）
  - 用户名（邮箱的 @ 前部分，如 `test`）
  - 用户邮箱（如 `test@example.com`）

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 6. 菜单项检查

**目标**：验证菜单结构和菜单项

**步骤**：
1. 菜单已展开（来自测试步骤 5）
2. 查看菜单中的所有项目

**预期结果**：
- ✅ 菜单显示以下 4 个菜单项（从上到下）：
  1. 个人资料（左侧有用户图标）
  2. 修改头像（左侧有图片图标）
  3. 设置（左侧有齿轮图标）
  4. 退出登录（左侧有开关图标，文字为红色）

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 7. 修改头像功能

**目标**：验证头像上传和更新

**步骤**：
1. 菜单已展开
2. 点击"修改头像"菜单项
3. 在文件选择器中选择一个图片文件（jpg、png 等）
4. 等待文件读取完成

**预期结果**：
- ✅ 浏览器打开文件选择对话框
- ✅ 选择图片后，菜单关闭
- ✅ 导航栏用户头像更新为新图片
- ✅ 显示"头像更新成功"提示信息（绿色）
- ✅ 刷新页面后，头像仍保持为新图片（本地存储）

**实际结果**：
- [ ] 通过 / [ ] 未通过

**注意**：头像保存为 Data URL 存储在 localStorage，每个用户约占 100KB 存储空间。

### 8. 退出登录功能

**目标**：验证登出流程

**步骤**：
1. 菜单已展开（未展开则点击头像）
2. 点击"退出登录"菜单项
3. 在弹出的确认对话框中查看文本

**预期结果**：
- ✅ 显示确认对话框
- ✅ 对话框文本为"确定退出登录吗？"
- ✅ 对话框有两个按钮："确定"（红色）和"取消"（灰色）

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 9. 确认退出登录

**目标**：验证退出登录后的状态

**步骤**：
1. 确认对话框已显示（来自测试步骤 8）
2. 点击"确定"按钮

**预期结果**：
- ✅ 对话框关闭
- ✅ 显示"退出成功"提示信息（绿色）
- ✅ 自动跳转到登录页 `/login`
- ✅ 导航栏不再显示用户头像
- ✅ 导航栏右侧重新显示"登录"按钮

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 10. 取消退出登录

**目标**：验证取消退出功能

**步骤**：
1. 点击头像打开菜单
2. 点击"退出登录"
3. 在确认对话框中点击"取消"按钮

**预期结果**：
- ✅ 对话框关闭
- ✅ 用户保持登录状态
- ✅ 导航栏继续显示用户头像
- ✅ 用户菜单已关闭

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 11. 菜单自动关闭

**目标**：验证点击页面其他区域时菜单自动关闭

**步骤**：
1. 菜单已展开
2. 点击页面的任意其他区域（非菜单区域）

**预期结果**：
- ✅ 用户菜单关闭
- ✅ 用户头像仍然可见且高亮状态恢复

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 12. 页面刷新后状态保持

**目标**：验证用户登录状态的持久化

**步骤**：
1. 确保已登录（导航栏显示用户头像）
2. 按 `F5` 或点击浏览器刷新按钮
3. 等待页面加载完成

**预期结果**：
- ✅ 页面刷新后，用户仍保持登录状态
- ✅ 导航栏继续显示用户头像
- ✅ 用户信息未丢失（邮箱、用户名等）

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 13. 响应式设计检查

**目标**：验证在不同屏幕尺寸上的表现

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 点击"设备工具栏"或"Toggle device toolbar"
3. 测试以下屏幕尺寸：
   - 手机：iPhone 12（390px）
   - 平板：iPad（768px）
   - 桌面：1920px

**预期结果**：
- ✅ 手机：导航栏用户头像和登录按钮正常显示，菜单卡片宽度自适应
- ✅ 平板：菜单卡片宽度 260px，布局合理
- ✅ 桌面：菜单卡片宽度 280px，所有元素对齐

**实际结果**：
- [ ] 通过 / [ ] 未通过

### 14. 深色主题检查

**目标**：验证深色主题适配

**步骤**：
1. 在导航栏找到主题切换器（通常在右上角）
2. 点击切换到深色主题
3. 点击用户头像打开菜单

**预期结果**：
- ✅ 菜单背景变为深色
- ✅ 菜单文字变为浅色
- ✅ 菜单项悬停效果仍可见
- ✅ 用户头像边框在深色背景上仍可见

**实际结果**：
- [ ] 通过 / [ ] 未通过

## 故障排除

### 问题 1：导航栏没有显示"登录"按钮

**原因可能**：
- 用户状态未正确初始化
- 组件导入错误

**解决方案**：
1. 打开浏览器控制台（F12）
2. 检查是否有 JavaScript 错误
3. 在控制台输入 `localStorage` 查看 `user` 键是否存在
4. 检查 `AppLayout.vue` 中 `useUserStore()` 的导入

### 问题 2：登录后导航栏没有显示用户头像

**原因可能**：
- Pinia store 未正确更新
- 组件未响应状态变化

**解决方案**：
1. 打开开发者工具，查看 Network 标签
2. 检查登录请求是否成功（模拟登录应该是立即完成）
3. 在 Vue DevTools 中查看 Pinia state
4. 确认 `userStore.isAuthenticated` 为 true

### 问题 3：菜单项点击无反应

**原因可能**：
- `handleMenuCommand` 函数中缺少对应 command 的处理
- 事件处理器绑定错误

**解决方案**：
1. 打开 `UserMenu.vue`
2. 检查 `handleMenuCommand` 函数是否包含所有 command 的处理逻辑
3. 在浏览器控制台添加 `console.log` 查看是否触发该函数

### 问题 4：头像修改后没有保存

**原因可能**：
- `updateAvatar` action 未正确执行
- localStorage 空间不足

**解决方案**：
1. 打开浏览器开发者工具的 Application 标签
2. 查看 localStorage 中 `user` 键的大小
3. 检查是否有其他数据占用空间
4. 尝试用更小的图片文件

### 问题 5：退出登录后仍显示用户头像

**原因可能**：
- `logout` action 未正确清空状态
- 组件缓存未更新

**解决方案**：
1. 强制刷新页面（Ctrl+Shift+R）
2. 清空 localStorage（在开发者工具中删除 `user` 键）
3. 检查 `user.js` 中的 `logout` action 是否包含所有必要的清空操作

## 性能检查

### 内存使用

**步骤**：
1. 打开开发者工具的 Performance 标签
2. 点击头像多次（打开/关闭菜单）
3. 查看内存使用是否稳定

**预期结果**：
- ✅ 菜单打开/关闭不增加内存占用
- ✅ 没有内存泄漏警告

### 加载速度

**步骤**：
1. 打开开发者工具的 Network 标签
2. 刷新页面
3. 查看首次加载时间

**预期结果**：
- ✅ 首次加载时间 < 2 秒
- ✅ 用户信息加载时间 < 500ms

## 总体测试结果

| 测试项目 | 结果 | 备注 |
|---------|------|------|
| 初始状态检查 | [ ] | |
| 跳转到登录页 | [ ] | |
| 表单验证 | [ ] | |
| 成功登录 | [ ] | |
| 用户菜单打开 | [ ] | |
| 菜单项检查 | [ ] | |
| 修改头像功能 | [ ] | |
| 退出登录功能 | [ ] | |
| 确认退出登录 | [ ] | |
| 取消退出登录 | [ ] | |
| 菜单自动关闭 | [ ] | |
| 页面刷新后状态保持 | [ ] | |
| 响应式设计检查 | [ ] | |
| 深色主题检查 | [ ] | |

**总体通过率**：__% （__/14 项通过）

## 下一步

- [ ] 所有测试通过 → 提交代码
- [ ] 部分测试失败 → 查看故障排除章节
- [ ] 集成 Supabase 真实认证
- [ ] 添加路由守卫保护页面
