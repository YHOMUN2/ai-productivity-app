<template>
  <div class="avatar-sync-demo">
    <!-- è¯´æ˜åŒº -->
    <div class="demo-header">
      <h1>ğŸ¯ å¤´åƒåŒæ­¥æ¼”ç¤º</h1>
      <p class="subtitle">éªŒè¯å¤´åƒä½œä¸ºå…¨ç«™å…±äº«çŠ¶æ€çš„æ­£ç¡®å»ºæ¨¡</p>
    </div>

    <!-- æ ¸å¿ƒåŸç†å±•ç¤º -->
    <div class="demo-section">
      <h2>ğŸ—ï¸ æ¶æ„åŸç†</h2>
      <div class="architecture-box">
        <div class="box-item store">
          <div class="box-title">Pinia Store</div>
          <div class="box-content">
            <code>profile.avatar_url</code>
            <div class="note">å”¯ä¸€çš„æ•°æ®æº</div>
          </div>
        </div>

        <div class="box-item arrow">â†’</div>

        <div class="box-item component">
          <div class="box-title">æ‰€æœ‰ç»„ä»¶</div>
          <div class="box-content">
            <code>userStore.userAvatar</code>
            <div class="note">å“åº”å¼åŒæ­¥</div>
          </div>
        </div>
      </div>
    </div>

    <!-- å®æ—¶æ•°æ®ç›‘æµ‹ -->
    <div class="demo-section">
      <h2>ğŸ” å®æ—¶æ•°æ®çŠ¶æ€</h2>
      <div class="data-monitor">
        <div class="monitor-item">
          <span class="label">å½“å‰å¤´åƒ URLï¼š</span>
          <code class="value">{{ userStore.userAvatar }}</code>
        </div>
        <div class="monitor-item">
          <span class="label">Store Profile Avatarï¼š</span>
          <code class="value">{{ userStore.profile?.avatar_url || 'æœªè®¾ç½®' }}</code>
        </div>
        <div class="monitor-item">
          <span class="label">ç”¨æˆ·åï¼š</span>
          <span class="value">{{ userStore.userName }}</span>
        </div>
        <div class="monitor-item">
          <span class="label">é‚®ç®±ï¼š</span>
          <span class="value">{{ userStore.userEmail }}</span>
        </div>
      </div>
    </div>

    <!-- ä¸‰ä¸ªä½ç½®çš„å¤´åƒæ˜¾ç¤º -->
    <div class="demo-section">
      <h2>ğŸ“¸ ä¸‰ä¸ªä½ç½®çš„å¤´åƒåŒæ­¥</h2>
      <div class="three-avatars">
        <!-- 1. Profile é¡µé¢ -->
        <div class="avatar-location">
          <div class="location-title">1ï¸âƒ£ Profile é¡µé¢</div>
          <div class="avatar-card">
            <img :src="userStore.userAvatar" class="avatar-img" />
            <div class="location-path">class="profile-avatar"</div>
          </div>
        </div>

        <!-- 2. UserMenu ç»„ä»¶ -->
        <div class="avatar-location">
          <div class="location-title">2ï¸âƒ£ UserMenu èœå•</div>
          <div class="avatar-card">
            <img :src="userStore.userAvatar" class="avatar-img" />
            <div class="location-path">class="user-avatar-large"</div>
          </div>
        </div>

        <!-- 3. AppLayout -->
        <div class="avatar-location">
          <div class="location-title">3ï¸âƒ£ AppLayout å¯¼èˆªæ </div>
          <div class="avatar-card">
            <img :src="userStore.userAvatar" class="avatar-img" />
            <div class="location-path">class="user-avatar"</div>
          </div>
        </div>
      </div>
    </div>

    <!-- æµ‹è¯•æµç¨‹ -->
    <div class="demo-section">
      <h2>âœ… å®Œæ•´æµ‹è¯•æµç¨‹</h2>
      <div class="test-steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">è®¿é—®ä¿®æ”¹å¤´åƒé¡µé¢</div>
            <el-button type="primary" @click="goToChangeAvatar">
              å‰å¾€ /change-avatar
            </el-button>
          </div>
        </div>

        <div class="step-arrow">â¬‡ï¸</div>

        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">ä¸Šä¼ æ–°å›¾ç‰‡</div>
            <p class="step-desc">é€‰æ‹©æˆ–æ‹–æ‹½ä¸Šä¼  JPG/PNG/GIF å›¾ç‰‡</p>
          </div>
        </div>

        <div class="step-arrow">â¬‡ï¸</div>

        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">ä¿å­˜å¤´åƒ</div>
            <p class="step-desc">ç‚¹å‡»ä¿å­˜ï¼Œè°ƒç”¨ userStore.updateAvatarInStore()</p>
          </div>
        </div>

        <div class="step-arrow">â¬‡ï¸</div>

        <div class="step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">éªŒè¯åŒæ­¥</div>
            <p class="step-desc">æ‰€æœ‰ä½ç½®çš„å¤´åƒç«‹å³æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°</p>
          </div>
        </div>
      </div>
    </div>

    <!-- å…³é”®ä»£ç  -->
    <div class="demo-section code-section">
      <h2>ğŸ’¡ å…³é”®ä»£ç ç‰‡æ®µ</h2>

      <!-- Store getter -->
      <div class="code-block">
        <div class="code-title">Store Getterï¼ˆå”¯ä¸€æ•°æ®æºï¼‰</div>
        <pre v-pre><code>userAvatar: (state) => {
  // ä¼˜å…ˆä» profile.avatar_url è¯»å–
  if (state.profile?.avatar_url) {
    return state.profile.avatar_url;
  }
  // é™çº§æ–¹æ¡ˆ
  return `https://api.dicebear.com/...`;
}</code></pre>
      </div>

      <!-- Store action -->
      <div class="code-block">
        <div class="code-title">Store Actionï¼ˆæ›´æ–°çŠ¶æ€ï¼‰</div>
        <pre v-pre><code>updateAvatarInStore(avatarUrl) {
  if (this.profile) {
    this.profile.avatar_url = avatarUrl;
  }
}</code></pre>
      </div>

      <!-- ç»„ä»¶ä½¿ç”¨ -->
      <div class="code-block">
        <div class="code-title">ç»„ä»¶ä½¿ç”¨ï¼ˆæ‰€æœ‰ä½ç½®ç›¸åŒï¼‰</div>
        <pre v-pre><code>&lt;img :src="userStore.userAvatar" /&gt;</code></pre>
      </div>

      <!-- ChangeAvatar ä¿å­˜ -->
      <div class="code-block">
        <div class="code-title">ChangeAvatar ä¿å­˜é€»è¾‘</div>
        <pre v-pre><code>async function saveAvatar() {
  // â­ ç«‹å³æ›´æ–°çŠ¶æ€
  userStore.updateAvatarInStore(previewImage);
  
  // ç„¶åè¿”å›é¡µé¢
  router.push('/profile');
}</code></pre>
      </div>
    </div>

    <!-- åŸç†è§£é‡Š -->
    <div class="demo-section principle-section">
      <h2>ğŸ§  ä¸ºä»€ä¹ˆè¿™æ ·åšæ˜¯å¯¹çš„</h2>
      <div class="principle-list">
        <div class="principle-item">
          <div class="principle-icon">âœ…</div>
          <div class="principle-content">
            <div class="principle-title">å•ä¸€æ•°æ®æº</div>
            <p>åªæœ‰ profile.avatar_url æ˜¯æƒå¨æ¥æºï¼Œé¿å…å¤šä¸ªåœ°æ–¹ç»´æŠ¤çŠ¶æ€å¯¼è‡´ä¸ä¸€è‡´</p>
          </div>
        </div>

        <div class="principle-item">
          <div class="principle-icon">âœ…</div>
          <div class="principle-content">
            <div class="principle-title">å“åº”å¼åŒæ­¥</div>
            <p>Vue çš„ååº”å¼ç³»ç»Ÿè‡ªåŠ¨é€šçŸ¥æ‰€æœ‰å¼•ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨ emit æˆ–åˆ·æ–°</p>
          </div>
        </div>

        <div class="principle-item">
          <div class="principle-icon">âœ…</div>
          <div class="principle-content">
            <div class="principle-title">è·¨é¡µé¢ä¸€è‡´</div>
            <p>ä» Profile è·³åˆ° ChangeAvatarï¼Œå¤´åƒå§‹ç»ˆæ¥è‡ªåŒä¸€ä¸ª storeï¼Œä¿è¯ä¸€è‡´æ€§</p>
          </div>
        </div>

        <div class="principle-item">
          <div class="principle-icon">âœ…</div>
          <div class="principle-content">
            <div class="principle-title">é¡µé¢åˆ·æ–°å®‰å…¨</div>
            <p>Store é…ç½®äº† persist: trueï¼Œæ•°æ®å­˜åˆ° localStorageï¼Œåˆ·æ–°åä»ä¿ç•™</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { useUserStore } from '@/stores/user';

const router = useRouter();
const userStore = useUserStore();

function goToChangeAvatar() {
  router.push('/change-avatar');
}
</script>

<style scoped>
.avatar-sync-demo {
  background-color: var(--bg-base);
  min-height: 100vh;
  padding: var(--spacing-xl);
}

.demo-header {
  max-width: 1200px;
  margin: 0 auto var(--spacing-xl);
  text-align: center;
  padding-bottom: var(--spacing-xl);
  border-bottom: 2px solid var(--accent);
}

.demo-header h1 {
  margin: 0 0 var(--spacing-sm) 0;
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
}

.subtitle {
  margin: 0;
  font-size: 1.1rem;
  color: var(--text-secondary);
}

.demo-section {
  max-width: 1200px;
  margin: 0 auto var(--spacing-xl);
}

.demo-section h2 {
  margin: 0 0 var(--spacing-lg) 0;
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-primary);
}

/* æ¶æ„å›¾ */
.architecture-box {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-lg);
  padding: var(--spacing-lg);
  background-color: var(--bg-surface);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-lg);
  flex-wrap: wrap;
}

.box-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-lg);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-md);
  min-width: 180px;
  text-align: center;
}

.box-item.store {
  border-left: 4px solid var(--accent);
}

.box-item.component {
  border-right: 4px solid #10b981;
}

.box-title {
  font-weight: 600;
  color: var(--text-primary);
}

.box-content {
  font-size: 0.9rem;
  font-family: 'Monaco', 'Menlo', monospace;
}

.box-item code {
  color: var(--accent);
  font-size: 0.85rem;
  padding: var(--spacing-xs);
  background-color: var(--bg-base);
  border-radius: 4px;
}

.box-item .note {
  font-size: 0.75rem;
  color: var(--text-secondary);
  margin-top: var(--spacing-xs);
}

.box-item.arrow {
  font-size: 1.5rem;
  color: var(--accent);
  min-width: auto;
  padding: 0;
  background: transparent;
}

/* æ•°æ®ç›‘æµ‹ */
.data-monitor {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-lg);
  background-color: var(--bg-surface);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.9rem;
}

.monitor-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-md);
  word-break: break-all;
}

.monitor-item .label {
  font-weight: 500;
  color: var(--text-secondary);
  margin-right: var(--spacing-md);
}

.monitor-item .value {
  color: var(--accent);
  flex: 1;
}

/* ä¸‰ä¸ªå¤´åƒä½ç½® */
.three-avatars {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-lg);
}

.avatar-location {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.location-title {
  font-weight: 600;
  font-size: 1.05rem;
  color: var(--text-primary);
}

.avatar-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-lg);
  background-color: var(--bg-surface);
  border: 2px solid var(--accent);
  border-radius: var(--radius-lg);
}

.avatar-img {
  width: 120px;
  height: 120px;
  border-radius: var(--radius-lg);
  object-fit: cover;
  border: 2px solid var(--border-color);
}

.location-path {
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.85rem;
  color: var(--text-secondary);
  text-align: center;
}

/* æµ‹è¯•æ­¥éª¤ */
.test-steps {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
  padding: var(--spacing-lg);
  background-color: var(--bg-surface);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
}

.step {
  display: flex;
  gap: var(--spacing-lg);
  padding: var(--spacing-lg);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-md);
}

.step-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background-color: var(--accent);
  color: white;
  font-weight: 700;
  font-size: 1.2rem;
  flex-shrink: 0;
}

.step-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: var(--spacing-sm);
}

.step-title {
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.step-desc {
  margin: 0;
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.step-arrow {
  text-align: center;
  font-size: 1.5rem;
  color: var(--accent);
}

/* ä»£ç å— */
.code-section {
  background-color: var(--bg-surface);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
}

.code-block {
  margin-bottom: var(--spacing-lg);
}

.code-block:last-child {
  margin-bottom: 0;
}

.code-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--spacing-sm);
  font-size: 0.95rem;
}

.code-block pre {
  margin: 0;
  padding: var(--spacing-md);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-md);
  border-left: 3px solid var(--accent);
  overflow-x: auto;
}

.code-block code {
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.85rem;
  color: var(--accent);
  line-height: 1.6;
}

/* åŸç†åˆ—è¡¨ */
.principle-section {
  background-color: var(--bg-surface);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
}

.principle-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-lg);
}

.principle-item {
  display: flex;
  gap: var(--spacing-md);
  padding: var(--spacing-lg);
  background-color: var(--bg-secondary);
  border-radius: var(--radius-md);
  border-left: 4px solid #10b981;
}

.principle-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.principle-content {
  flex: 1;
}

.principle-title {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--spacing-xs);
}

.principle-content p {
  margin: 0;
  font-size: 0.9rem;
  color: var(--text-secondary);
  line-height: 1.6;
}

/* å“åº”å¼ */
@media (max-width: 768px) {
  .demo-header h1 {
    font-size: 1.8rem;
  }

  .architecture-box {
    flex-direction: column;
  }

  .step {
    flex-direction: column;
    align-items: flex-start;
  }

  .three-avatars {
    grid-template-columns: 1fr;
  }
}
</style>
